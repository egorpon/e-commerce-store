{% include 'store/base.html' %}

{% load static %}
{% load crispy_forms_tags %}
{% block content %}
  <div class="container bg-white shadow-md p-5" style="width:500px; border-radius:20px;">
    <form id="form" method="post">
      {% csrf_token %}
      <div>
        <h3><i class="fa fa-chevron-circle-right" aria-hidden="true"></i> Complete your order</h3>

        <p>Please enter in the relevant information below.</p>

        <br />
        {{ form|crispy }}

        {% comment %} <div class="form-field">
          <input class="form-control validate" id="name" type="text" placeholder="Full name*" autocomplete="off" value="{{ shipping.full_name }}" required />
        </div>

        <br />

        <div class="form-field">
          <input class="form-control validate" id="email" type="email" placeholder="Email address*" autocomplete="off" value="{{ shipping.email }}" required />
        </div>

        <br />

        <div class="form-field">
          <input class="form-control validate" id="address1" type="text" placeholder="Address 1*" autocomplete="off" value="{{ shipping.address1 }}" required />
        </div>

        <br />

        <div class="form-field">
          <input class="form-control validate" id="address2" type="text" placeholder="Address 2 (Optional)" autocomplete="off" value="{% if shipping.address2 %}{{ shipping.address2 }}{% endif %}" />
        </div>

        <br />

        <div class="form-field">
          <input class="form-control validate" id="city" type="text" placeholder="City*" autocomplete="off" value="{{ shipping.city }}" required />
        </div>

        <br />

        <div class="form-field">
          <input class="form-control" id="state" type="text" placeholder="State (Optional)" autocomplete="off" value="{% if shipping.state %}{{ shipping.state }}{% endif %}" />
        </div>

        <br />

        <div class="form-field">
          <input class="form-control" id="zipcode" type="text" placeholder="Zip code (Optional)" autocomplete="off" value="{% if shipping.zipcode %}{{ shipping.zipcode }}{% endif %}" />
        </div>
      </div>

      {% endcomment %}
      <br />
      <button id="complete-order" type="submit" class="btn btn-primary navbar-btn text-white w-100">&nbsp; Complete order</button>

      <br />
    </form>
  </div>

  <!-- Ajax integration -->

  <script>
    $(document).on('submit', function (e) {
      e.preventDefault()
      $.ajax({
        type: 'POST',
        url: '{% url "complete_order" %}',
        data: {
          name: $('#name').val(),
          email: $('#email').val(),
          address1: $('#address1').val(),
          address2: $('#address2').val(),
          city: $('#city').val(),
          state: $('#state').val(),
          zipcode: $('#zipcode').val(),
          csrfmiddlewaretoken: '{{csrf_token}}',
          action: 'post'
        },
    
        success: function (json) {
          window.location.replace("{% url 'payment_success' %}")
        },
    
        error: function (xhr, errmsg, err) {
          window.location.replace("{% url 'payment_failed' %}")
        }
      })
    })
  </script>
{% endblock %}
